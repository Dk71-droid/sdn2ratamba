<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal Guru: Dashboard & Aplikasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Base styles for light mode */
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f0f4f8; /* Light blue-gray background */
        color: #334155; /* Slate-700 text */
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        font-size: 1rem; /* Default font size to base for better readability */
      }

      .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 2rem 1rem;
        flex-grow: 1; /* Allows container to grow and fill available space */
      }

      .top-nav {
        background-color: #ffffff; /* White background for nav */
        padding: 1rem 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        border-radius: 1rem; /* Rounded corners */
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
      }

      .content-area {
        background-color: #ffffff;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }

      .bottom-nav {
        display: none; /* Hidden on desktop */
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #ffffff;
        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
        border-top-left-radius: 1rem;
        border-top-right-radius: 1rem;
        justify-content: space-around;
        align-items: center;
        padding: 0.5rem 0;
        z-index: 1000;
      }

      .bottom-nav button {
        flex: 1;
        padding: 0.75rem 0.5rem;
        font-size: 0.75rem;
        color: #64748b;
        transition: color 0.3s ease;
        background: none;
        border: none;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
      }

      .bottom-nav button.active,
      .bottom-nav button:hover {
        color: #4a5568;
      }

      .bottom-nav button i {
        font-size: 1.25rem;
      }

      /* Responsiveness */
      @media (max-width: 768px) {
        .top-nav {
          display: none; /* Hide desktop nav on mobile */
        }

        .main-content {
          padding-bottom: 4rem; /* Add padding for bottom nav */
        }

        .bottom-nav {
          display: flex; /* Show bottom nav on mobile */
        }
      }

      .active-link {
        color: #4338ca; /* Indigo-700 */
        font-weight: 600;
      }

      .active-link .icon {
        color: #4338ca; /* Indigo-700 */
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 2000;
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: #fff;
        animation: spin 1s ease infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .message-box {
        position: fixed;
        bottom: 1.5rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 1rem 2rem;
        border-radius: 9999px; /* Fully rounded */
        color: white;
        text-align: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 3000;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
      }

      .message-box.show {
        opacity: 1;
      }

      .message-box.success {
        background-color: #10b981; /* Green-500 */
      }

      .message-box.error {
        background-color: #ef4444; /* Red-500 */
      }

      .message-box.loading {
        background-color: #3b82f6; /* Blue-500 */
      }
    </style>
  </head>
  <body class="bg-gray-100 flex flex-col min-h-screen text-gray-800">
    <div
      class="flex flex-col md:flex-row flex-1"
      x-data="{ sidebarOpen: window.innerWidth >= 768 }"
    >
      <!-- Sidebar / Top Nav for desktop -->
      <aside
        class="bg-white text-gray-800 shadow-lg w-full md:w-64 space-y-6 py-7 px-2 absolute inset-y-0 left-0 transform md:relative md:translate-x-0 transition duration-200 ease-in-out z-50"
        :class="{ 'translate-x-0': sidebarOpen, '-translate-x-full': !sidebarOpen }"
        @click.away="sidebarOpen = window.innerWidth >= 768"
      >
        <div class="flex items-center justify-between px-4">
          <a href="#" class="text-2xl font-bold text-blue-700">Portal Guru</a>
          <button
            class="md:hidden text-gray-500 hover:text-gray-700 focus:outline-none"
            @click="sidebarOpen = false"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <nav class="flex-1">
          <ul class="space-y-2">
            <li>
              <a
                href="#"
                id="navDashboard"
                data-view="dashboard"
                class="flex items-center space-x-3 text-gray-600 p-2 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors active-link"
              >
                <i class="fas fa-chart-pie icon"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                id="navSoal"
                data-view="soal"
                class="flex items-center space-x-3 text-gray-600 p-2 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors"
              >
                <i class="fas fa-pencil-alt icon"></i>
                <span>Latihan Harian</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                id="navMateri"
                data-view="materi"
                class="flex items-center space-x-3 text-gray-600 p-2 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors"
              >
                <i class="fas fa-book icon"></i>
                <span>Materi</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                id="navJadwalTugas"
                data-view="jadwal-tugas"
                class="flex items-center space-x-3 text-gray-600 p-2 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors"
              >
                <i class="fas fa-calendar-check icon"></i>
                <span>Jadwal & Tugas</span>
              </a>
            </li>
            <li>
              <a
                href="#"
                id="navPengaturan"
                data-view="pengaturan"
                class="flex items-center space-x-3 text-gray-600 p-2 rounded-lg hover:bg-blue-100 hover:text-blue-700 transition-colors"
              >
                <i class="fas fa-cog icon"></i>
                <span>Pengaturan</span>
              </a>
            </li>
            <li class="mt-4">
              <button
                id="logoutButton"
                class="flex items-center w-full space-x-3 text-red-600 p-2 rounded-lg hover:bg-red-100 transition-colors"
              >
                <i class="fas fa-sign-out-alt icon"></i>
                <span>Logout</span>
              </button>
            </li>
          </ul>
        </nav>
      </aside>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col">
        <header
          class="flex items-center justify-between p-4 bg-white shadow md:hidden"
        >
          <button
            class="text-gray-500 hover:text-gray-700 focus:outline-none"
            @click="sidebarOpen = true"
          >
            <i class="fas fa-bars text-xl"></i>
          </button>
          <span class="text-xl font-bold text-blue-700">Portal Guru</span>
          <button
            id="mobileLogoutButton"
            class="text-red-600 hover:text-red-700 focus:outline-none"
          >
            <i class="fas fa-sign-out-alt text-xl"></i>
          </button>
        </header>

        <main class="flex-1 p-4 md:p-6 main-content">
          <div id="content-view">
            <!-- Dynamic content will be loaded here -->
            <h1 class="text-2xl md:text-3xl font-bold text-blue-700 mb-6">
              Dashboard
            </h1>

            <div
              id="dashboard-view"
              class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
            >
              <div
                class="bg-white p-6 rounded-2xl shadow-xl transition transform hover:scale-105 duration-300"
              >
                <div class="flex items-center mb-4">
                  <i
                    class="fas fa-users text-2xl text-blue-500 mr-4 p-3 bg-blue-100 rounded-full"
                  ></i>
                  <h3 class="text-lg font-semibold text-gray-700">
                    Total Siswa
                  </h3>
                </div>
                <p id="totalStudentsCount" class="text-4xl font-bold">0</p>
                <button
                  id="viewAllStudentsBtn"
                  class="mt-4 w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors"
                >
                  Lihat Semua Siswa
                </button>
              </div>

              <div
                class="bg-white p-6 rounded-2xl shadow-xl transition transform hover:scale-105 duration-300"
              >
                <div class="flex items-center mb-4">
                  <i
                    class="fas fa-tasks text-2xl text-green-500 mr-4 p-3 bg-green-100 rounded-full"
                  ></i>
                  <h3 class="text-lg font-semibold text-gray-700">
                    Tugas & Jadwal
                  </h3>
                </div>
                <p id="scheduledTasksCount" class="text-4xl font-bold">0</p>
                <button
                  id="viewScheduledTasksBtn"
                  class="mt-4 w-full bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors"
                >
                  Lihat Jadwal
                </button>
              </div>

              <div
                class="bg-white p-6 rounded-2xl shadow-xl transition transform hover:scale-105 duration-300"
              >
                <div class="flex items-center mb-4">
                  <i
                    class="fas fa-chalkboard-teacher text-2xl text-purple-500 mr-4 p-3 bg-purple-100 rounded-full"
                  ></i>
                  <h3 class="text-lg font-semibold text-gray-700">
                    Materi Tersedia
                  </h3>
                </div>
                <p id="availableMaterialsCount" class="text-4xl font-bold">0</p>
                <button
                  id="viewAvailableMaterialsBtn"
                  class="mt-4 w-full bg-purple-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-purple-600 transition-colors"
                >
                  Lihat Materi
                </button>
              </div>
            </div>

            <!-- Chart Section -->
            <div class="bg-white p-6 rounded-2xl shadow-xl mt-6 lg:col-span-2">
              <h3 class="text-lg font-semibold text-gray-700 mb-4">
                Analisis Kinerja Siswa
              </h3>
              <canvas id="studentPerformanceChart"></canvas>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Modals -->
    <div id="modal-container">
      <!-- Modal: Register Student -->
      <div
        id="registerStudentModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-md overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-blue-700">Daftar Siswa Baru</h3>
            <button
              id="closeRegisterStudentModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <form id="registerStudentForm">
            <div class="mb-4">
              <label
                for="studentName"
                class="block text-gray-700 text-sm font-semibold mb-2"
                >Nama Siswa</label
              >
              <input
                type="text"
                id="studentName"
                name="studentName"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
              <p
                id="error-studentName"
                class="text-red-500 text-xs mt-1 hidden"
              ></p>
            </div>
            <div class="mb-4">
              <label
                for="studentEmail"
                class="block text-gray-700 text-sm font-semibold mb-2"
                >Email</label
              >
              <input
                type="email"
                id="studentEmail"
                name="studentEmail"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
              <p
                id="error-studentEmail"
                class="text-red-500 text-xs mt-1 hidden"
              ></p>
            </div>
            <div class="mb-4">
              <label
                for="studentPassword"
                class="block text-gray-700 text-sm font-semibold mb-2"
                >Password</label
              >
              <input
                type="password"
                id="studentPassword"
                name="studentPassword"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                required
              />
              <p
                id="error-studentPassword"
                class="text-red-500 text-xs mt-1 hidden"
              ></p>
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
            >
              Daftar Siswa
            </button>
          </form>
        </div>
      </div>

      <!-- Modal: View All Students -->
      <div
        id="viewAllStudentsModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-4xl overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-blue-700">Daftar Semua Siswa</h3>
            <button
              id="closeViewAllStudentsModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <table class="min-w-full divide-y divide-gray-200" id="studentTable">
            <thead>
              <tr>
                <th
                  class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Nama Siswa
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Email
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Status
                </th>
                <th
                  class="px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"
                >
                  Aksi
                </th>
              </tr>
            </thead>
            <tbody
              class="bg-white divide-y divide-gray-200"
              id="studentTableBody"
            >
              <!-- Student rows will be injected here -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Modal: Add / Edit Exercise -->
      <div
        id="editDailyExerciseModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-4xl overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-blue-700">
              Kelola Latihan Harian
            </h3>
            <button
              id="closeEditDailyExerciseModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <form id="dailyExerciseForm" class="space-y-4">
            <div>
              <label for="exerciseType" class="block text-gray-700 font-bold"
                >Jenis Latihan</label
              >
              <select
                id="exerciseType"
                name="exerciseType"
                class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="matematika">Matematika</option>
                <option value="sains">Sains</option>
                <option value="sejarah">Sejarah</option>
                <option value="bahasa-inggris">Bahasa Inggris</option>
              </select>
            </div>
            <div>
              <label for="exerciseTopic" class="block text-gray-700 font-bold"
                >Topik/Deskripsi</label
              >
              <textarea
                id="exerciseTopic"
                name="exerciseTopic"
                rows="4"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Misal: 'Soal cerita tentang penjumlahan dan pengurangan untuk kelas 2 SD'."
              ></textarea>
            </div>
            <div>
              <label
                for="exerciseQuestion"
                class="block text-gray-700 font-bold"
                >Soal (Opsional, jika ingin membuat manual)</label
              >
              <textarea
                id="exerciseQuestion"
                name="exerciseQuestion"
                rows="4"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Isi soal latihan di sini. Biarkan kosong jika ingin dibuat otomatis oleh AI."
              ></textarea>
            </div>
            <div>
              <label for="exerciseAnswer" class="block text-gray-700 font-bold"
                >Jawaban (Opsional, untuk soal manual)</label
              >
              <input
                type="text"
                id="exerciseAnswer"
                name="exerciseAnswer"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Jawaban untuk soal manual."
              />
            </div>
            <div class="flex space-x-2">
              <button
                type="button"
                id="generateExerciseBtn"
                class="w-1/2 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center"
              >
                <i class="fas fa-magic mr-2"></i> Buat dengan AI
              </button>
              <button
                type="submit"
                id="saveExerciseBtn"
                class="w-1/2 bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center"
              >
                <i class="fas fa-save mr-2"></i> Simpan Latihan
              </button>
            </div>
            <button
              type="button"
              id="deleteExerciseBtn"
              class="w-full bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors mt-2 hidden"
            >
              <i class="fas fa-trash-alt mr-2"></i> Hapus Latihan
            </button>
          </form>
        </div>
      </div>

      <!-- NEW MODAL: Add / Edit Materi -->
      <div
        id="editMateriModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-4xl overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-blue-700">Kelola Materi Baru</h3>
            <button
              id="closeEditMateriModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <form id="materiForm" class="space-y-4">
            <div>
              <label for="materiType" class="block text-gray-700 font-bold"
                >Jenis Materi</label
              >
              <select
                id="materiType"
                name="materiType"
                class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="matematika">Matematika</option>
                <option value="sains">Sains</option>
                <option value="sejarah">Sejarah</option>
                <option value="bahasa-inggris">Bahasa Inggris</option>
              </select>
            </div>
            <div>
              <label for="materiTopic" class="block text-gray-700 font-bold"
                >Topik Materi</label
              >
              <input
                type="text"
                id="materiTopic"
                name="materiTopic"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Contoh: 'Teorema Pythagoras' atau 'Perang Dunia I'."
              />
            </div>
            <div>
              <label for="materiClass" class="block text-gray-700 font-bold"
                >Tingkat Kelas</label
              >
              <select
                id="materiClass"
                name="materiClass"
                class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              >
                <option value="semua">Semua Tingkat</option>
                <option value="sd-kelas-1">SD Kelas 1</option>
                <option value="sd-kelas-2">SD Kelas 2</option>
                <option value="sd-kelas-3">SD Kelas 3</option>
                <option value="sd-kelas-4">SD Kelas 4</option>
                <option value="sd-kelas-5">SD Kelas 5</option>
                <option value="sd-kelas-6">SD Kelas 6</option>
                <option value="smp-kelas-7">SMP Kelas 7</option>
                <option value="smp-kelas-8">SMP Kelas 8</option>
                <option value="smp-kelas-9">SMP Kelas 9</option>
                <option value="sma-kelas-10">SMA Kelas 10</option>
                <option value="sma-kelas-11">SMA Kelas 11</option>
                <option value="sma-kelas-12">SMA Kelas 12</option>
              </select>
            </div>
            <div>
              <label for="materiFocus" class="block text-gray-700 font-bold"
                >Fokus Pembahasan</label
              >
              <textarea
                id="materiFocus"
                name="materiFocus"
                rows="4"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Jelaskan secara singkat poin-poin utama yang ingin Anda bahas. Biarkan kosong untuk mendapatkan saran dari AI."
              ></textarea>
            </div>
            <div class="flex space-x-2">
              <button
                type="button"
                id="generateMateriSuggestionsBtn"
                class="w-1/2 bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors flex items-center justify-center"
              >
                <i class="fas fa-lightbulb mr-2"></i> Saran AI
              </button>
              <button
                type="button"
                id="generateMateriContentBtn"
                class="w-1/2 bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors flex items-center justify-center"
              >
                <i class="fas fa-magic mr-2"></i> Buat Materi AI
              </button>
            </div>
            <p
              id="generationStatus"
              class="text-sm text-gray-500 mt-2 italic hidden"
            >
              Materi sedang dibuat oleh AI...
            </p>
            <div id="materiContentInputGroup" class="mt-4 hidden">
              <label for="materiContent" class="block text-gray-700 font-bold"
                >Konten Materi</label
              >
              <textarea
                id="materiContent"
                name="materiContent"
                rows="10"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                placeholder="Isi materi akan muncul di sini. Anda dapat mengeditnya jika diperlukan."
              ></textarea>
            </div>
            <div class="flex space-x-2" id="materiActionButtons">
              <button
                type="submit"
                id="saveMateriBtn"
                class="w-full bg-green-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center hidden"
              >
                <i class="fas fa-save mr-2"></i> Simpan Materi
              </button>
              <button
                type="button"
                id="deleteMateriBtn"
                class="w-full bg-red-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center hidden"
              >
                <i class="fas fa-trash-alt mr-2"></i> Hapus Materi
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal: View Material Details -->
      <div
        id="viewMaterialDetailsModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-4xl overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-blue-700" id="viewMaterialTitle">
              Detail Materi:
            </h3>
            <button
              id="closeViewMaterialDetailsModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <div id="materialContentDisplayInModal">
            <!-- Detailed lesson content will be rendered here by renderLessonContentDisplay -->
          </div>
        </div>
      </div>

      <!-- NEW MODAL: Confirm Delete -->
      <div
        id="confirmModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[2000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-sm overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-red-700">Konfirmasi</h3>
            <button
              id="closeConfirmModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <p id="confirmMessage" class="text-gray-700 mb-4">
            Apakah Anda yakin ingin melakukan tindakan ini?
          </p>
          <div class="flex justify-end space-x-2">
            <button
              id="confirmCancelBtn"
              class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg font-semibold hover:bg-gray-400 transition-colors"
            >
              Batal
            </button>
            <button
              id="confirmActionBtn"
              class="bg-red-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-red-700 transition-colors"
            >
              Ya, Hapus
            </button>
          </div>
        </div>
      </div>

      <!-- Modal: Change Password -->
      <div
        id="changePasswordModal"
        class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-[1000] modal-overlay hidden"
      >
        <div
          class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-md overflow-y-auto"
        >
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold text-blue-700">Ubah Kata Sandi</h3>
            <button
              id="closeChangePasswordModal"
              class="text-gray-500 hover:text-gray-700 text-2xl font-bold"
            >
              ×
            </button>
          </div>
          <form id="changePasswordForm" class="space-y-4">
            <div>
              <label for="currentPassword" class="block text-gray-700 font-bold"
                >Kata Sandi Saat Ini</label
              >
              <input
                type="password"
                id="currentPassword"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <p
                id="error-currentPassword"
                class="text-red-500 text-xs mt-1 hidden"
              ></p>
            </div>
            <div>
              <label for="newPassword" class="block text-gray-700 font-bold"
                >Kata Sandi Baru</label
              >
              <input
                type="password"
                id="newPassword"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <p
                id="error-newPassword"
                class="text-red-500 text-xs mt-1 hidden"
              ></p>
            </div>
            <div>
              <label
                for="confirmNewPassword"
                class="block text-gray-700 font-bold"
                >Konfirmasi Kata Sandi Baru</label
              >
              <input
                type="password"
                id="confirmNewPassword"
                class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <p
                id="error-confirmNewPassword"
                class="text-red-500 text-xs mt-1 hidden"
              ></p>
            </div>
            <button
              type="submit"
              class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
            >
              Ubah Kata Sandi
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Message Box -->
    <div id="message-box" class="message-box"></div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
      <div class="spinner"></div>
    </div>

    <script type="module">
      import {
        auth,
        onAuthStateChanged,
        signOut,
        db,
        doc,
        getDoc,
      } from "./js/firebase.js";
      import { showMessage, hideLoadingOverlay } from "./js/utils.js";
      import { initializeApp } from "./js/app.js";

      // --- Auth State Listener ---
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          console.log(
            "portalguru.html: Pengguna masuk. Memeriksa peran guru..."
          );
          try {
            const teacherDoc = await getDoc(doc(db, "teachers", user.uid));
            if (!teacherDoc.exists()) {
              console.error(
                "portalguru.html: Dokumen guru tidak ditemukan di Firestore. Mengarahkan ke halaman login."
              );
              showMessage(
                "error",
                "Akses ditolak. Akun Anda tidak terdaftar sebagai guru."
              );
              // ADDED A DELAY to allow the user to see the error message and console
              setTimeout(async () => {
                await signOut(auth);
                window.location.href = "loginguru.html";
              }, 3000); // 3 second delay
            } else {
              console.log(
                "portalguru.html: Dokumen guru ditemukan. Memuat aplikasi."
              );
              // If teacher document exists, initialize the main application logic
              initializeApp();
            }
          } catch (error) {
            console.error(
              "portalguru.html: Error saat memeriksa dokumen guru:",
              error
            );
            showMessage("error", "Gagal memuat data guru. Silakan coba lagi.");
            // ADDED A DELAY for error visibility
            setTimeout(async () => {
              await signOut(auth);
              window.location.href = "loginguru.html";
            }, 3000); // 3 second delay
          } finally {
            hideLoadingOverlay();
          }
        } else {
          // User is signed out, redirect to login page
          console.log(
            "portalguru.html: Pengguna logout. Mengarahkan ke halaman login."
          );
          window.location.href = "loginguru.html";
        }
      });
    </script>
  </body>
</html>
