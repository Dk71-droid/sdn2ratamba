<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Guru</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f0f4f8; /* Light blue-gray background */
        color: #334155; /* Slate-700 text */
        margin: 0;
        padding: 0;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        font-size: 1rem; /* Default font size to base for better readability */
      }

      /* Specific centering for login form within its view */
      .login-center-container {
        min-height: 100vh; /* Ensure this container takes full height to center content */
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        padding: 1rem; /* Reduced padding for mobile */
      }
      @media (max-width: 767px) {
        .login-center-container {
          padding: 0.6rem; /* Further reduced padding on small screens */
        }
      }

      /* Custom styles for input/textarea */
      input[type="text"],
      input[type="password"],
      input[type="email"],
      input[type="number"],
      textarea {
        @apply w-full p-2 border border-gray-300 rounded-md focus:ring-cyan-500 focus:border-cyan-500 transition duration-200 text-base; /* Ensure text-base for inputs */
      }
      /* Specific adjustment for button padding/font */
      .btn-primary {
        @apply bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105 text-sm;
      }

      /* Overlay Loading */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
      }
      .loading-overlay.show {
        opacity: 1;
        visibility: visible;
      }
      .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #fff;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <!-- Login View -->
    <div id="loginView" class="full-screen-view">
      <div class="login-center-container bg-f0f4f8">
        <div
          class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-sm text-center"
        >
          <h2 class="text-3xl font-bold text-cyan-700 mb-6">Login Guru</h2>
          <form id="teacherLoginForm" class="space-y-4">
            <div>
              <label
                for="teacherEmail"
                class="block text-gray-700 text-sm font-semibold mb-2"
                >Email Guru:</label
              >
              <input
                type="email"
                id="teacherEmail"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-cyan-500 focus:border-cyan-500 transition duration-200 text-base"
                placeholder="email@guru.com"
                required
              />
            </div>
            <div>
              <label
                for="teacherPassword"
                class="block text-sm font-medium text-gray-700 mb-2"
                >Password:</label
              >
              <input
                type="password"
                id="teacherPassword"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-cyan-500 focus:border-cyan-500 transition duration-200 text-base"
                placeholder="********"
                required
              />
            </div>
            <button
              type="submit"
              class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition duration-300 ease-in-out transform hover:scale-105"
            >
              Login Guru
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Overlay Loading -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // --- Firebase Configuration ---
      // Ganti dengan konfigurasi Firebase Anda dari Firebase Console
      const firebaseConfig = {
        apiKey: "AIzaSyBWTYZH2OZuyq_mnbbxiap7iBg-17II55A", // Replace with your actual Firebase API Key
        authDomain: "tabungansiswa-8bbd6.firebaseapp.com",
        projectId: "tabungansiswa-8bbd6",
        storageBucket: "tabungansiswa-8bbd6.firebasestorage.app",
        messagingSenderId: "1068130708793",
        appId: "1:1068130708793:web:d6afeed38a9d42dd034ce8",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // --- DOM Elements ---
      const teacherLoginForm = document.getElementById("teacherLoginForm");
      const loadingOverlay = document.getElementById("loadingOverlay");

      // --- Helper Functions ---
      function showLoadingOverlay() {
        loadingOverlay.classList.add("show");
      }

      function hideLoadingOverlay() {
        loadingOverlay.classList.remove("show");
      }

      /**
       * Shows a generic message using the globalMessage element.
       * This function is simplified for the login page and does not use the full globalMessage component from portalguru.html.
       * It's included here to prevent errors if the original showMessage is called.
       * For a full notification system, you'd integrate the globalMessage div and its logic.
       */
      const showMessage = (type, text, titleOverride = null) => {
        console.log(`[${type.toUpperCase()}] ${titleOverride || ""} ${text}`);
        // In a real application, you'd show a user-friendly message here,
        // perhaps a small, temporary alert or a toast notification.
        // For this login page, we're primarily using the loading overlay.
      };

      // --- Firebase Auth State Listener ---
      onAuthStateChanged(auth, async (user) => {
        if (user) {
          // User is signed in, check if they are a teacher
          const userDocRef = doc(db, "users", user.uid);
          const userDocSnap = await getDoc(userDocRef);

          if (userDocSnap.exists() && userDocSnap.data().role === "teacher") {
            // Redirect to the teacher portal dashboard
            window.location.href = "portalguru.html"; // Assuming portalguru.html is in the same directory
          } else {
            // Not a teacher or data not found, sign out and show error
            showMessage("error", "Akses ditolak. Silakan login sebagai guru.");
            auth.signOut();
            hideLoadingOverlay();
          }
        } else {
          // User is signed out
          hideLoadingOverlay();
        }
      });

      // --- Event Listeners ---
      teacherLoginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        showLoadingOverlay();

        const email = document.getElementById("teacherEmail").value;
        const password = document.getElementById("teacherPassword").value;

        try {
          await signInWithEmailAndPassword(auth, email, password);
          // onAuthStateChanged will handle redirection on successful login
        } catch (error) {
          console.error("Login guru error:", error);
          let errorMessage = "Terjadi kesalahan saat login guru.";
          if (error.code === "auth/invalid-email") {
            errorMessage = "Email guru tidak valid.";
          } else if (error.code === "auth/user-disabled") {
            errorMessage = "Akun guru ini telah dinonaktifkan.";
          } else if (
            error.code === "auth/user-not-found" ||
            error.code === "auth/wrong-password" ||
            error.code === "auth/invalid-credential"
          ) {
            errorMessage = "Email atau password guru salah.";
          }
          showMessage("error", errorMessage);
          hideLoadingOverlay();
        }
      });
    </script>
  </body>
</html>
